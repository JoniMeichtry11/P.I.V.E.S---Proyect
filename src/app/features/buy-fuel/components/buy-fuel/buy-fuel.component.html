<div class="max-w-4xl mx-auto p-4 md:p-8 space-y-12">
  <!-- Payment Gateway Modal -->
  @if (selectedPackage && !isProcessing) {
    <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl p-6 max-w-md w-full relative">
        <button (click)="closePaymentModal()" title="Cerrar" class="absolute top-3 right-3 text-slate-400 hover:text-slate-700 text-3xl leading-none font-bold">&times;</button>
        <h2 class="text-2xl font-display text-slate-800 text-center">Finalizar Carga</h2>
        <div class="bg-slate-50 border border-slate-200 rounded-lg p-3 my-4 text-center">
          <p>EstÃ¡s cargando</p>
          <p class="text-3xl font-display text-amber-600">{{ selectedPackage.liters }} Litros â›½</p>
          <p class="font-bold text-xl">por ${{ selectedPackage.price.toLocaleString('es-AR') }} ARS</p>
        </div>
        <div class="flex border-b border-slate-200">
          <button (click)="paymentMethod = 'card'" [class.border-b-2]="paymentMethod === 'card'" [class.border-blue-500]="paymentMethod === 'card'" [class.text-blue-600]="paymentMethod === 'card'" [class.text-slate-500]="paymentMethod !== 'card'" class="flex-1 py-2 text-center font-bold">Tarjeta</button>
          <button (click)="paymentMethod = 'wallet'" [class.border-b-2]="paymentMethod === 'wallet'" [class.border-blue-500]="paymentMethod === 'wallet'" [class.text-blue-600]="paymentMethod === 'wallet'" [class.text-slate-500]="paymentMethod !== 'wallet'" class="flex-1 py-2 text-center font-bold">Billetera Virtual</button>
        </div>
        @if (paymentMethod === 'card') {
          <div class="space-y-3 pt-4">
            <div><label class="text-xs">NÃºmero de Tarjeta</label><input type="text" placeholder="**** **** **** ****" class="w-full p-2 border rounded"/></div>
            <div><label class="text-xs">Nombre en la Tarjeta</label><input type="text" placeholder="Nombre Apellido" class="w-full p-2 border rounded"/></div>
            <div class="flex gap-2">
              <div class="flex-1"><label class="text-xs">Vencimiento</label><input type="text" placeholder="MM/AA" class="w-full p-2 border rounded"/></div>
              <div class="flex-1"><label class="text-xs">CVC</label><input type="text" placeholder="***" class="w-full p-2 border rounded"/></div>
            </div>
            <button (click)="handleFinalizePayment()" class="w-full mt-4 bg-blue-500 text-white font-bold py-3 rounded-lg hover:bg-blue-600">Pagar ${{ selectedPackage.price.toLocaleString('es-AR') }}</button>
          </div>
        }
        @if (paymentMethod === 'wallet') {
          <div class="pt-4 text-center">
            <p class="mb-2">Escanea el QR para pagar o elige tu Billetera:</p>
            <img src="https://i.ibb.co/Kz0pHP2P/QR-encuesta.png" alt="CÃ³digo QR de pago" class="w-40 h-40 mx-auto border-4 border-slate-200 rounded-lg"/>
            <div class="flex justify-center gap-4 my-4">
              <img src="https://i.ibb.co/5W3WGp79/MPago.png" alt="Mercado Pago" class="h-8"/>
              <img src="https://i.ibb.co/dwBCVcV9/modo.png" alt="MODO" class="h-8"/>
              <img src="https://i.ibb.co/MDzmhsYb/Pers-Pay.png" alt="Personal Pay" class="h-8"/>
            </div>
            <button (click)="handleFinalizePayment()" class="w-full mt-2 bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600">Ya realicÃ© el pago</button>
          </div>
        }
      </div>
    </div>
  }

  <!-- Processing Modal -->
  @if (isProcessing) {
    <div class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
        <h2 class="text-2xl font-display text-slate-700 mt-4">Procesando Pago...</h2>
        <p class="text-slate-500 mt-2">Estamos confirmando tu carga de forma segura. Por favor, espera un momento.</p>
      </div>
    </div>
  }

  <!-- Success Modal -->
  @if (showSuccessModal) {
    <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl p-6 max-w-sm w-full text-center">
        <div class="text-6xl mb-4">â›½ðŸŽ‰</div>
        <h2 class="text-2xl font-display text-slate-800">Â¡Carga Exitosa!</h2>
        <p class="text-slate-600 my-4">Se han aÃ±adido <span class="font-bold">{{ purchasedAmount }} Litros</span> a tu tanque. Â¿QuÃ© quieres hacer ahora?</p>
        <div class="flex flex-col gap-3">
          <button (click)="closeSuccessModal(); router.navigate(['/booking'])" class="w-full py-3 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600">
            Ir a Reservar un Coche
          </button>
          <button (click)="closeSuccessModal(); router.navigate(['/home'])" class="w-full py-2 bg-slate-200 text-slate-700 font-bold rounded-lg hover:bg-slate-300">
            Volver al Inicio
          </button>
        </div>
      </div>
    </div>
  }

  <h1 class="text-4xl md:text-5xl font-display text-center text-slate-700">EstaciÃ³n de Servicio</h1>

  @if (feedbackMessage) {
    <div [class.bg-green-500]="feedbackMessage.type === 'success'" [class.bg-red-500]="feedbackMessage.type === 'error'" class="p-4 rounded-lg text-center font-bold text-white">
      {{ feedbackMessage.text }}
    </div>
  }

  <div class="bg-white p-6 rounded-2xl shadow-xl">
    <h2 class="text-3xl font-display text-slate-800 mb-6 text-center">Paquetes de Combustible</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      @for (pkg of FUEL_PACKAGES; track pkg) {
        <div [class]="'relative p-5 rounded-xl text-white bg-gradient-to-br ' + pkg.bgColor + ' flex flex-col items-center justify-between shadow-lg'">
          @if (pkg.bonus) {
            <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-full">{{ pkg.bonus }}</span>
          }
          <div class="text-center">
            <p class="text-5xl font-display">{{ pkg.liters }}</p>
            <p class="font-bold text-2xl">â›½</p>
          </div>
          <button (click)="handleSelectPackage(pkg)" class="w-full mt-4 bg-white/30 hover:bg-white/50 transition-colors font-bold py-2 px-4 rounded-lg">
            ${{ pkg.price.toLocaleString('es-AR') }} ARS
          </button>
        </div>
      }
    </div>
    <p class="text-xs text-slate-400 mt-6 text-center">
      Los pagos son simulados para esta demostraciÃ³n.
    </p>
  </div>

  <div class="bg-white p-6 rounded-2xl shadow-xl">
    <h2 class="text-3xl font-display text-slate-800 mb-6 text-center">Canjear CupÃ³n de Combustible</h2>
    <p class="text-center text-slate-500 mb-4 max-w-md mx-auto">
      Si tienes un cupÃ³n de un evento o regalo, Â¡ingrÃ©salo aquÃ­ para cargar tu tanque!
    </p>
    <form (ngSubmit)="handleRedeemCodeSubmit()" class="flex flex-col md:flex-row gap-2 max-w-sm mx-auto">
      <input
        type="text"
        [(ngModel)]="redeemCode"
        name="redeemCode"
        placeholder="Ej: PIVESREGALO25"
        class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center font-mono uppercase"
        />
        <button type="submit" class="px-6 py-3 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 whitespace-nowrap">
          Canjear
        </button>
      </form>
    </div>
  </div>


