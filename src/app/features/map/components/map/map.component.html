<div class="events-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="text-slate-700 font-display">ğŸ—ºï¸ Mapa de Eventos</h1>
      <p class="header-subtitle">ExplorÃ¡ los prÃ³ximos eventos y sus ubicaciones</p>
    </div>
    @if (isAdmin) {
      <button class="btn-create" (click)="openCreateForm()">
        <span class="plus-icon">+</span> Nuevo Evento
      </button>
    }
  </div>

  <div class="main-layout">
    <!-- Mapa Interactivo (Google Maps) -->
    <div class="map-panel">
      <google-map
        width="100%"
        height="100%"
        [center]="center"
        [zoom]="zoom"
        [options]="options"
      >
        <!-- Marcadores -->
        @for (data of mapEventsData; track data.event.id) {
          <map-marker
            #marker="mapMarker"
            [position]="data.position"
            [options]="data.markerOptions"
            (mapClick)="openInfoWindow(marker, data.event)"
          ></map-marker>

          <!-- Recorrido -->
          @if (data.polylineOptions) {
            <map-polyline [options]="data.polylineOptions"></map-polyline>
          }
        }

        <!-- Info Window -->
        <map-info-window>
          @if (selectedEvent) {
            <div class="info-window-content">
              <h3>{{ selectedEvent.title }}</h3>
              <p>ğŸ“… {{ formatDisplayDate(selectedEvent.date) }} {{ selectedEvent.time }}</p>
              <p>ğŸ“ {{ selectedEvent.location }}</p>
            </div>
          }
        </map-info-window>
      </google-map>
    </div>

    <!-- Lista de Eventos -->
    <div class="events-panel">
      <h2 class="events-title">ğŸ“… PrÃ³ximos Eventos</h2>

      @if (isLoading) {
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Cargando eventos...</p>
        </div>
      } @else if (events.length === 0) {
        <div class="empty-state">
          <span class="empty-icon">ğŸˆ</span>
          <p>No hay eventos programados todavÃ­a.</p>
          @if (isAdmin) {
            <button class="btn-create-sm" (click)="openCreateForm()">Crear el primero</button>
          }
        </div>
      } @else {
        <div class="events-list">
          @for (event of events; track event.id) {
            <div
              class="event-card"
              [class.selected]="selectedEvent?.id === event.id"
              (click)="focusOnEvent(event)"
            >
              <div class="event-card-header">
                <span class="category-badge" [ngClass]="getCategoryColorClass(event.category)">
                  {{ getCategoryEmoji(event.category) }} {{ getCategoryLabel(event.category) }}
                </span>
                @if (isAdmin) {
                  <div class="event-actions">
                    <button class="action-btn edit-btn" title="Editar" (click)="openEditForm(event); $event.stopPropagation()">âœï¸</button>
                    <button class="action-btn delete-btn" title="Eliminar" (click)="confirmDeleteEvent(event); $event.stopPropagation()">ğŸ—‘ï¸</button>
                  </div>
                }
              </div>

              <h3 class="event-title">{{ event.title }}</h3>
              <div class="event-meta">
                <span>ğŸ“… {{ formatDisplayDate(event.date) }}</span>
                @if (event.time) {
                  <span>ğŸ• {{ event.time }}</span>
                }
              </div>
              <p class="event-location">ğŸ“ {{ event.location }}</p>
              <p class="event-description">{{ event.description }}</p>

              @if (event.route && event.route.length > 0) {
                <span class="route-badge">ğŸ›¤ï¸ Recorrido trazado</span>
              }

              <!-- ConfirmaciÃ³n de eliminaciÃ³n -->
              @if (deletingEventId === event.id) {
                <div class="delete-confirm" (click)="$event.stopPropagation()">
                  <p>Â¿Eliminar este evento?</p>
                  <div class="delete-confirm-actions">
                    <button class="btn-confirm-delete" (click)="deleteEvent(event)">SÃ­, eliminar</button>
                    <button class="btn-cancel-delete" (click)="cancelDelete()">Cancelar</button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Modal de Formulario -->
  @if (showEventForm) {
    <app-event-form
      [event]="editingEvent"
      (save)="onSaveEvent($event)"
      (cancel)="closeForm()"
    ></app-event-form>
  }
</div>
